# æ•°æ®ç®¡ç†å’Œè”åŠ¨æ”¹è¿›æ€»ç»“

## å·²å®Œæˆçš„æ”¹è¿›

### 1. åˆ›å»ºç»Ÿä¸€æ•°æ®ç®¡ç†æ¨¡å— (`unified-data-manager.js`)

**åŠŸèƒ½ï¼š**
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…æ–¹æ•°æ®ï¼Œæ— è®ºæ¥æº
- è‡ªåŠ¨è¿ç§»æ—§æ•°æ®æ ¼å¼
- æ•°æ®æ ¼å¼è½¬æ¢ï¼ˆformula-builder â†” recipe-databaseï¼‰
- å‘åå…¼å®¹æ—§ç³»ç»Ÿ

**ä¸»è¦æ–¹æ³•ï¼š**
- `init()` - åˆå§‹åŒ–å¹¶è¿ç§»æ—§æ•°æ®
- `convertFromFormulaBuilder()` - ä» formula-builder æ ¼å¼è½¬æ¢
- `convertToFormulaBuilder()` - è½¬æ¢ä¸º formula-builder æ ¼å¼
- `getAllRecipes()` - è·å–æ‰€æœ‰é…æ–¹ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
- `addRecipe()` / `updateRecipe()` / `deleteRecipe()` - CRUD æ“ä½œ
- `searchRecipes()` - æœç´¢é…æ–¹
- `exportAll()` / `importAll()` - å¯¼å…¥å¯¼å‡º
- `syncToLegacySystems()` - åŒæ­¥åˆ°æ—§ç³»ç»Ÿï¼ˆå‘åå…¼å®¹ï¼‰

### 2. å®ç°æ•°æ®è”åŠ¨

**formula-builder.html:**
- âœ… ç°åœ¨ä½¿ç”¨ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨ä¿å­˜é…æ–¹
- âœ… ä¿å­˜çš„é…æ–¹å¯ä»¥åœ¨ `recipe-database.html` ä¸­æŸ¥çœ‹
- âœ… ä¿æŒå‘åå…¼å®¹ï¼ˆåŒæ—¶ä¿å­˜åˆ°æ—§æ ¼å¼ï¼‰

**recipe-database.html:**
- âœ… ä½¿ç”¨ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨è¯»å–æ‰€æœ‰é…æ–¹
- âœ… å¯ä»¥æŸ¥çœ‹æ¥è‡ª formula-builder çš„é…æ–¹
- âœ… æ‰€æœ‰æ“ä½œï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰éƒ½é€šè¿‡ç»Ÿä¸€æ¥å£

### 3. æ•°æ®æ ¼å¼ç»Ÿä¸€

**ç»Ÿä¸€æ ¼å¼åŒ…å«ï¼š**
- åŸºç¡€å­—æ®µï¼šid, name, purpose, total, dilution, carrier, solvent, notes
- ç²¾æ²¹åˆ—è¡¨ï¼šoils[] (name, amount, note)
- å®‰å…¨ä¿¡æ¯ï¼šsafetyFlag
- å…ƒæ•°æ®ï¼šupdatedAt, source, sourceId
- æ‰©å±•å­—æ®µï¼šbaseType, baseAmount, totalDrops, totalMl, concentrationï¼ˆå…¼å®¹ formula-builderï¼‰

### 4. å‘åå…¼å®¹

- âœ… æ—§æ•°æ®è‡ªåŠ¨è¿ç§»åˆ°æ–°æ ¼å¼
- âœ… æ–°ç³»ç»Ÿå¯ä»¥è¯»å–æ—§æ ¼å¼æ•°æ®
- âœ… æ—§ç³»ç»Ÿä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼ˆå¦‚æœ UnifiedDataManager ä¸å¯ç”¨ï¼‰

## æ•°æ®å­˜å‚¨ç»“æ„

### ç»Ÿä¸€å­˜å‚¨ Key
- `unified_recipes_v1` - æ‰€æœ‰é…æ–¹çš„ç»Ÿä¸€å­˜å‚¨

### æ—§å­˜å‚¨ Keysï¼ˆä»ä¿ç•™ç”¨äºå…¼å®¹ï¼‰
- `savedFormulas` - formula-builder çš„æ—§æ ¼å¼
- `eo_recipes_v1` - recipe-database çš„æ—§æ ¼å¼
- `eo_lists_v1` - åº“å­˜åˆ—è¡¨

## ä½¿ç”¨æ–¹å¼

### åœ¨é¡µé¢ä¸­ä½¿ç”¨

```javascript
// æ£€æŸ¥æ˜¯å¦å¯ç”¨
if (typeof UnifiedDataManager !== 'undefined') {
    // è·å–æ‰€æœ‰é…æ–¹
    const recipes = UnifiedDataManager.getAllRecipes();
    
    // æ·»åŠ é…æ–¹
    UnifiedDataManager.addRecipe(newRecipe);
    
    // æœç´¢é…æ–¹
    const results = UnifiedDataManager.searchRecipes('åŠ©çœ ', 'è–°è¡£è‰');
    
    // å¯¼å‡ºæ•°æ®
    const json = UnifiedDataManager.exportAll();
}
```

## å¾…æ”¹è¿›é¡¹

### 1. åŠŸèƒ½é‡å é—®é¢˜
- âš ï¸ `recipe-database.html` å’Œ `ç²¾æ²¹é…æ–¹æ•°æ®åº“ï¼ˆhtml_å•æ–‡ä»¶ï¼‰.html` åŠŸèƒ½é‡å¤
- ğŸ’¡ å»ºè®®ï¼šæ ‡è®°å•æ–‡ä»¶ç‰ˆæœ¬ä¸º"æ—§ç‰ˆ"ï¼Œæˆ–åˆ é™¤

### 2. é…æ–¹æ¨èè”åŠ¨
- âš ï¸ ç”¨æˆ·åˆ›å»ºçš„é…æ–¹æ— æ³•åŸºäºé—®å·æ•°æ®è¿›è¡Œæ¨è
- ğŸ’¡ å»ºè®®ï¼šæ‰©å±• `formula-suggestions.js`ï¼Œæ”¯æŒç”¨æˆ·é…æ–¹çš„è¯„åˆ†å’Œæ¨è

### 3. æ•°æ®ç»Ÿè®¡
- âœ… å·²å®ç° `getStats()` æ–¹æ³•
- ğŸ’¡ å»ºè®®ï¼šåœ¨ UI ä¸­æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼ˆé…æ–¹æ€»æ•°ã€æ¥æºåˆ†å¸ƒç­‰ï¼‰

## æµ‹è¯•å»ºè®®

1. **æ•°æ®è¿ç§»æµ‹è¯•**
   - æ¸…é™¤ `data_migration_completed` flag
   - é‡æ–°åŠ è½½é¡µé¢ï¼Œæ£€æŸ¥æ—§æ•°æ®æ˜¯å¦æˆåŠŸè¿ç§»

2. **è·¨é¡µé¢è”åŠ¨æµ‹è¯•**
   - åœ¨ `formula-builder.html` åˆ›å»ºé…æ–¹
   - åœ¨ `recipe-database.html` æŸ¥çœ‹æ˜¯å¦å‡ºç°
   - åœ¨ `recipe-database.html` ç¼–è¾‘é…æ–¹
   - æ£€æŸ¥ `formula-builder.html` ä¸­çš„é…æ–¹æ˜¯å¦æ›´æ–°

3. **å¯¼å…¥å¯¼å‡ºæµ‹è¯•**
   - å¯¼å‡ºæ•°æ®
   - æ¸…ç©ºæ•°æ®åº“
   - å¯¼å…¥æ•°æ®
   - æ£€æŸ¥æ‰€æœ‰é…æ–¹æ˜¯å¦æ¢å¤

## æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶
- `unified-data-manager.js` - ç»Ÿä¸€æ•°æ®ç®¡ç†æ¨¡å—
- `DATA_ANALYSIS.md` - æ•°æ®åˆ†ææŠ¥å‘Š
- `IMPROVEMENTS.md` - æœ¬æ–‡ä»¶

### ä¿®æ”¹æ–‡ä»¶
- `formula-builder.js` - ä½¿ç”¨ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨
- `formula-builder.html` - æ·»åŠ  unified-data-manager.js å¼•ç”¨
- `recipe-database.js` - ä½¿ç”¨ç»Ÿä¸€æ•°æ®ç®¡ç†å™¨
- `recipe-database.html` - æ·»åŠ  unified-data-manager.js å¼•ç”¨

## ä¸‹ä¸€æ­¥å»ºè®®

1. **æ•´åˆå•æ–‡ä»¶ç‰ˆæœ¬**
   - å†³å®šæ˜¯å¦ä¿ç•™ `ç²¾æ²¹é…æ–¹æ•°æ®åº“ï¼ˆhtml_å•æ–‡ä»¶ï¼‰.html`
   - å¦‚æœä¿ç•™ï¼Œæ·»åŠ è¿ç§»æç¤º

2. **å¢å¼ºæ¨èç³»ç»Ÿ**
   - è®©ç”¨æˆ·åˆ›å»ºçš„é…æ–¹ä¹Ÿå¯ä»¥åŸºäºé—®å·æ¨è
   - å®ç°é…æ–¹è¯„åˆ†ç®—æ³•

3. **æ·»åŠ æ•°æ®ç»Ÿè®¡é¢æ¿**
   - æ˜¾ç¤ºé…æ–¹æ€»æ•°ã€æ¥æºåˆ†å¸ƒ
   - æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„é…æ–¹

4. **ç”¨æˆ·è´¦æˆ·å…³è”**
   - å°†é…æ–¹æ•°æ®å…³è”åˆ°ç”¨æˆ·è´¦æˆ·
   - å®ç°å¤šç”¨æˆ·æ•°æ®éš”ç¦»

