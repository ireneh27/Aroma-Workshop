<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="配方实验器">
    <title>配方实验器 - 个性化芳疗方案</title>
    <link rel="stylesheet" href="styles.css">
</head>
    <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">跳转到主要内容</a>
    
    <!-- 固定导航栏 -->
    <div class="fixed-nav" id="fixedNav" role="navigation" aria-label="主导航">
        <div class="nav-content">
            <div class="logo"><a href="index.html" aria-label="返回首页">个性化芳疗方案</a></div>
            <button class="menu-toggle" id="menuToggle" aria-label="切换菜单" aria-expanded="false" aria-controls="navMenu">☰</button>
            <nav id="navMenu" role="navigation">
                <a href="index.html">首页</a>
                <a href="essential-oils.html">常用精油介绍</a>
                <a href="formula-library.html">经典配方库</a>
                <a href="formula-builder.html" aria-current="page">配方实验</a>
                <a href="making.html">制作指南</a>
                <a href="health-profile.html">您的信息档案</a>
                <a href="formulas.html">您的定制芳疗体验</a>
                <a href="recipe-database.html">您的私人配方库</a>
                <a href="login.html" id="navLoginLink">登录</a>
                <span id="navUserInfo" style="display: none; padding: var(--spacing-sm) var(--spacing-md); color: var(--accent-color); font-weight: 600;"></span>
            </nav>
        </div>
    </div>

    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="backToTop" aria-label="返回顶部">↑</button>

    <main id="main-content" class="container">
        <div class="page-header">
            <h1>配方实验器</h1>
        </div>

        <div class="formula-builder" id="formula-builder">
            <!-- 芳疗配方基本原则提示 -->
            <div class="formula-principles">
                <div class="principles-header">
                    <h3>芳疗配方基本原则</h3>
                </div>
                <ul class="principles-list">
                    <li><strong>安全第一：</strong>不同介质的安全浓度不同，请根据选择的介质类型控制总浓度</li>
                    <li><strong>个体差异：</strong>首次使用前建议进行斑贴测试，确认无过敏反应后再使用</li>
                    <li><strong>浓度控制：</strong>面部和敏感部位建议0.5-1%，身体日常使用1-2%，局部短期使用3-5%</li>
                    <li><strong>精油搭配：</strong>一般配方建议2-5种精油，避免过多精油混合导致功效冲突</li>
                    <li><strong>特殊人群：</strong>孕妇、儿童、老人、慢性病患者需特别注意禁忌，必要时咨询专业人士</li>
                    <li><strong>光敏性：</strong>柑橘类精油（如佛手柑、柠檬）使用后12小时内避免日晒</li>
                    <li><strong>用量限制：</strong>每日精油总用量建议不超过0.6ml，避免长期高浓度使用</li>
                </ul>
            </div>
            
            <div class="builder-controls">
                <div class="form-group">
                    <label for="oilSelect">
                        <span class="label-text">选择精油</span>
                        <span class="label-required">*</span>
                    </label>
                    <select id="oilSelect" class="form-select" aria-label="选择要添加的精油" aria-required="true">
                        <option value="">-- 选择精油 --</option>
                    </select>
                    <small style="display: block; margin-top: 4px; color: var(--secondary-color); font-size: 12px;">
                        建议配方包含2-5种精油
                    </small>
                </div>
                <div class="form-group">
                    <label for="baseType">
                        <span class="label-text">介质类型</span>
                        <span class="label-required">*</span>
                    </label>
                    <select id="baseType" class="form-select" aria-label="选择介质类型" aria-required="true">
                        <option value="base-oil">基础油（按摩油、滚珠等）- 安全上限≤3%</option>
                        <option value="handcream">护手霜 - 安全上限≤2%</option>
                        <option value="bodylotion">身体乳 - 安全上限≤2%</option>
                        <option value="rosewater">玫瑰水/纯露 - 安全上限≤1.5%</option>
                        <option value="alcohol">95%乙醇（香水、喷雾等）- 安全上限≤10%</option>
                        <option value="footbath">泡脚/泡澡 - 安全上限≤0.5%</option>
                        <option value="spray">喷雾 - 安全上限≤3%</option>
                        <option value="diffuser">扩香 - 不计入皮肤接触量</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="baseAmount">
                        <span class="label-text">基底总量</span>
                        <span class="label-unit">(g/ml)</span>
                    </label>
                    <input type="number" id="baseAmount" class="form-input" value="50" min="1" step="1" 
                           aria-label="基底总量" aria-required="true">
                    <small style="display: block; margin-top: 4px; color: var(--secondary-color); font-size: 12px;">
                        根据实际制作量调整
                    </small>
                </div>
            </div>
            
            <div class="builder-actions">
                <button class="btn btn-primary" onclick="addOil()" aria-label="将选中的精油添加到配方中">添加精油</button>
            </div>
            
            <div class="formula-ingredients" id="ingredientsList">
                <div class="empty-state" id="emptyState">还没有添加精油，请从上方选择并添加</div>
            </div>
            
            <div class="formula-summary" id="formulaSummary" style="display: none;">
                <div class="summary-header">
                    <h3>配方摘要</h3>
                </div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="summary-label">基底类型</span>
                        <span class="summary-value" id="baseTypeDisplay">基础油</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">总滴数</span>
                        <span class="summary-value" id="totalDrops">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">总精油量</span>
                        <span class="summary-value" id="totalMl">0.00 <span class="unit">ml</span></span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">配方浓度</span>
                        <span class="summary-value" id="concentration">0%</span>
                    </div>
                    <div class="summary-item" id="dailyUsageItem" style="display: none;">
                        <span class="summary-label">每日用量</span>
                        <span class="summary-value" id="dailyUsage" title="">-</span>
                    </div>
                </div>
                <div class="summary-safety">
                    <span class="summary-label">安全状态</span>
                    <span class="summary-value safety-status" id="safetyStatus">-</span>
                </div>
            </div>
            
            <div id="safetyCheck" class="safety-check-container" style="display: none;"></div>
            
            <div class="formula-save-section">
                <div class="formula-name-input-wrapper">
                    <input type="text" id="formulaName" class="formula-name-input" placeholder="配方名称 (可选)" 
                           aria-label="配方名称">
                </div>
                <div class="formula-save-actions">
                    <button class="btn btn-success" onclick="saveFormula()" aria-label="保存当前配方">保存配方</button>
                    <button class="btn btn-secondary" onclick="clearFormula()" aria-label="清空当前配方">清空配方</button>
                </div>
            </div>
        </div>

        <!-- 已保存的配方 -->
        <div class="saved-formulas" id="savedFormulasSection" style="display: none;">
            <div class="section-header">
                <h2>最近保存的配方</h2>
                <p class="section-subtitle">显示最近三个配方，您可以加载、编辑或删除</p>
            </div>
            <div id="savedFormulasList" class="saved-formulas-grid"></div>
        </div>
        <div class="footer">
            <p>
                本指南专为您的健康状况定制<br>
                建议连续使用6-8周后评估效果<br>
                如有任何不适,请立即停用并咨询专业人士<br><br>
                <strong>制定日期:2025年11月</strong>
            </p>
        </div>
    </main>

    <script src="common.js"></script>
    <script src="auth.js"></script>
    <script src="auth-nav.js"></script>
    <script src="oil-database.js"></script>
    <script src="recipe-db.js"></script>
    <script src="safety-evaluator.js"></script>
    <script src="unified-data-manager.js"></script>
    <script src="formula-builder.js"></script>
</body>
</html>